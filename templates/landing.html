{% extends 'base.html' %}
{% block title %}Bem-vindo • Supermercado{% endblock %}
{# usando floatformat padrão, sem biblioteca customizada #}
{% block content %}
<div class="card">
  <h1>Bem-vindo ao Supermercado</h1>
  <p>Seu delivery sem JavaScript no cliente — agora em Django.</p>
  <div style="margin-top: 12px;">
    {% if request.user.is_authenticated %}
      <p>Bem-vindo, {{ request.user.first_name|default:request.user.username }}!</p>
      <a class="btn" href="{% url 'carrinho' %}">Ver carrinho</a>
    {% else %}
      <a class="btn" href="{% url 'login' %}">Entrar</a>
      <span style="margin: 0 8px;">ou</span>
      <a class="btn" href="{% url 'cadastro' %}">Criar conta</a>
    {% endif %}
  </div>
</div>

<div class="container" style="margin-top:16px;">
  {% if produtos %}
  <div class="grid" style="display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:1rem;">
    {% for p in produtos %}
      <div class="card">
        {% if p.imagem %}
          <img src="{{ p.imagem }}" alt="{{ p.nome }}" style="width:100%;height:140px;object-fit:cover;border-radius:6px;" />
        {% endif %}
        <h3>{{ p.nome }}</h3>
        {% if p.descricao %}
          <p>{{ p.descricao }}</p>
        {% endif %}
        <p><strong>R$ {{ p.preco_unit|floatformat:2 }}</strong></p>
        <p style="color:#555;">Estoque: {{ p.estoque }}</p>
        {% if p.estoque > 0 %}
          <form method="post" action="{% url 'carrinho_adicionar' p.id %}">
            {% csrf_token %}
            <button class="btn" type="submit">Adicionar ao carrinho</button>
          </form>
        {% else %}
          <p><em>Indisponível</em></p>
        {% endif %}
      </div>
    {% endfor %}
  </div>
  {% else %}
    <div class="card"><p>Nenhum produto cadastrado ainda.</p></div>
  {% endif %}
</div>
{% endblock %}